"""
–ú–æ–∫–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ API
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
"""
import random
from typing import List, Dict
from datetime import datetime, timedelta


class MockGoszakupParser:
    """–¢–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""

    def __init__(self):
        self.test_organizations = [
            {
                'name': '–ì–£ "–ì–æ—Ä–æ–¥—Å–∫–∞—è –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞ ‚Ññ5"',
                'bin': '123456789012',
                'address': '–≥. –ê–ª–º–∞—Ç—ã, —É–ª. –ê–±–∞—è 150',
                'region': '–≥. –ê–ª–º–∞—Ç—ã'
            },
            {
                'name': '–ö–ì–ü "–û–±–ª–∞—Å—Ç–Ω–∞—è –±–æ–ª—å–Ω–∏—Ü–∞"',
                'bin': '234567890123',
                'address': '–ê–∫–º–æ–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≥. –ö–æ–∫—à–µ—Ç–∞—É, —É–ª. –ê—É—ç–∑–æ–≤–∞ 45',
                'region': '–ê–∫–º–æ–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'
            },
            {
                'name': '–¢–û–û "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –ê—Å—Ç–∞–Ω–∞"',
                'bin': '345678901234',
                'address': '–≥. –ê—Å—Ç–∞–Ω–∞, –ø—Ä. –ö–∞–±–∞–Ω–±–∞–π –±–∞—Ç—ã—Ä–∞ 12',
                'region': '–≥. –ê—Å—Ç–∞–Ω–∞'
            },
            {
                'name': '–ö–ì–£ "–¢—É—Ä–∫–µ—Å—Ç–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç–Ω–∞—è –±–æ–ª—å–Ω–∏—Ü–∞"',
                'bin': '456789012345',
                'address': '–¢—É—Ä–∫–µ—Å—Ç–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≥. –¢—É—Ä–∫–µ—Å—Ç–∞–Ω, —É–ª. –ë–∞–π–¥–∏–±–µ–∫ –±–∏ 78',
                'region': '–¢—É—Ä–∫–µ—Å—Ç–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'
            },
            {
                'name': '–ì–ö–ü "–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç–Ω–∞—è –∫–ª–∏–Ω–∏—á–µ—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞"',
                'bin': '567890123456',
                'address': '–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≥. –¢–∞–ª–¥—ã–∫–æ—Ä–≥–∞–Ω, —É–ª. –ñ–∞–Ω—Å—É–≥—É—Ä–æ–≤–∞ 23',
                'region': '–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'
            }
        ]

        self.test_lots = [
            {
                'keyword': '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è',
                'name': '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö',
                'description': '–ó–∞–∫—É–ø –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–¥–µ–ª–∏–π –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π'
            },
            {
                'keyword': '–∞—Ä–µ–Ω–¥–∞',
                'name': '–ê—Ä–µ–Ω–¥–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                'description': '–£—Å–ª—É–≥–∏ –ø–æ –∞—Ä–µ–Ω–¥–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ 12 –º–µ—Å—è—Ü–µ–≤'
            },
            {
                'keyword': '—Ä–µ–∞–≥–µ–Ω—Ç—ã',
                'name': '–•–∏–º–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–≥–µ–Ω—Ç—ã –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–π',
                'description': '–ü–æ—Å—Ç–∞–≤–∫–∞ —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –∫–ª–∏–Ω–∏–∫–æ-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–π'
            },
            {
                'keyword': '–¥–µ—Ç–∞–ª–∏',
                'name': '–ó–∞–ø–∞—Å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                'description': '–ó–∞–∫—É–ø –∑–∞–ø–∞—Å–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π –∏ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏—Ö –¥–ª—è —Ä–µ–º–æ–Ω—Ç–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è'
            },
            {
                'keyword': '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è',
                'name': '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –∏–∑–¥–µ–ª–∏–µ - —à–ø—Ä–∏—Ü—ã –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ',
                'description': '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è - —à–ø—Ä–∏—Ü—ã —Ä–∞–∑–ª–∏—á–Ω–æ–≥–æ –æ–±—ä–µ–º–∞'
            },
            {
                'keyword': '–∞—Ä–µ–Ω–¥–∞',
                'name': '–ê—Ä–µ–Ω–¥–∞ –ø–æ–º–µ—â–µ–Ω–∏–π –ø–æ–¥ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∫–∞–±–∏–Ω–µ—Ç',
                'description': '–ê—Ä–µ–Ω–¥–∞ –Ω–µ–∂–∏–ª–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø–ª–æ—â–∞–¥—å—é 50 –∫–≤.–º'
            }
        ]

    def search_lots(self, keywords: List[str], days_back: int = 7) -> List[Dict]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –ª–æ—Ç—ã

        Args:
            keywords: –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ)
            days_back: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)

        Returns:
            –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ª–æ—Ç–æ–≤
        """
        print("üß™ –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
        print(f"üîç –ü–æ–∏—Å–∫ –ª–æ—Ç–æ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º: {', '.join(keywords)}")

        found_lots = []

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç 2 –¥–æ 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –ª–æ—Ç–æ–≤
        num_lots = random.randint(2, 5)

        for i in range(num_lots):
            # –°–ª—É—á–∞–π–Ω—ã–π –ª–æ—Ç –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
            lot = random.choice(self.test_lots)
            org = random.choice(self.test_organizations)

            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è
            announcement_number = f"TEST-{datetime.now().year}-{random.randint(1000, 9999)}-{i}"

            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ä–æ–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–æ–∫ (—á–µ—Ä–µ–∑ 7-30 –¥–Ω–µ–π –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã)
            days_ahead = random.randint(7, 30)
            application_deadline = datetime.now() + timedelta(days=days_ahead)

            # –°–ø–æ—Å–æ–±—ã –∑–∞–∫—É–ø–∫–∏
            procurement_methods = [
                '–ö–æ–Ω–∫—É—Ä—Å',
                '–¢–µ–Ω–¥–µ—Ä',
                '–ó–∞–ø—Ä–æ—Å —Ü–µ–Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π',
                '–ò–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞',
                '–ê—É–∫—Ü–∏–æ–Ω'
            ]

            lot_data = {
                'announcement_number': announcement_number,
                'announcement_url': f"https://goszakup.gov.kz/ru/announce/index/{random.randint(10000, 99999)}",
                'organization_name': org['name'],
                'organization_bin': org['bin'],
                'legal_address': org['address'],
                'region': org['region'],
                'lot_name': lot['name'],
                'lot_description': lot['description'],
                'keyword_matched': lot['keyword'],
                'application_deadline': application_deadline,
                'procurement_method': random.choice(procurement_methods)
            }

            found_lots.append(lot_data)
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ª–æ—Ç: {lot_data['lot_name'][:50]}...")

        print(f"üìä –í—Å–µ–≥–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ª–æ—Ç–æ–≤: {len(found_lots)}")
        return found_lots

    def get_announcement_details(self, trd_buy_id: int) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"""
        org = random.choice(self.test_organizations)
        return {
            'number_anno': f"TEST-ANNO-{random.randint(1000, 9999)}",
            'customer_name': org['name'],
            'customer_bin': org['bin'],
            'customer_address': org['address'],
            'customer_region': org['region']
        }


# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
if __name__ == '__main__':
    parser = MockGoszakupParser()

    test_keywords = ["–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è", "–∞—Ä–µ–Ω–¥–∞", "—Ä–µ–∞–≥–µ–Ω—Ç—ã", "–¥–µ—Ç–∞–ª–∏"]
    results = parser.search_lots(test_keywords, days_back=7)

    print(f"\nüìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
    print(f"–ù–∞–π–¥–µ–Ω–æ –ª–æ—Ç–æ–≤: {len(results)}")

    if results:
        print("\n" + "="*60)
        for i, lot in enumerate(results, 1):
            print(f"\n–õ–æ—Ç #{i}:")
            print(f"  –ù–æ–º–µ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è: {lot['announcement_number']}")
            print(f"  –ù–∞–∑–≤–∞–Ω–∏–µ: {lot['lot_name']}")
            print(f"  –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: {lot['organization_name']}")
            print(f"  –†–µ–≥–∏–æ–Ω: {lot['region']}")
            print(f"  –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: {lot['keyword_matched']}")
            print(f"  URL: {lot['announcement_url']}")
